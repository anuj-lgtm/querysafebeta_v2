{% extends 'user_querySafe/include/base.html' %}
{% load static %}
{% block title %}Subscription Plans{% endblock %}

{% block content %}
<style>
  /* ── Layout ── */
  .pricing-section { padding: 2rem 0; }
  .pricing-header { text-align: center; margin-bottom: 2rem; }
  .pricing-header h2 { font-weight: 700; color: #222; font-size: 1.6rem; }
  .pricing-header p { color: #777; max-width: 480px; margin: 0.4rem auto 0; font-size: 0.95rem; }

  /* Force all 3 cards into one row on the dashboard */
  .plans-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
    max-width: 960px;
    margin: 0 auto;
  }
  @media (max-width: 991px) {
    .plans-grid { grid-template-columns: 1fr; max-width: 420px; }
  }
  @media (min-width: 992px) and (max-width: 1199px) {
    .plans-grid { max-width: 840px; }
  }

  /* ── Card base ── */
  .plan-card {
    border: 1px solid #e9ecef;
    border-radius: 16px;
    background: #fff;
    display: flex;
    flex-direction: column;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  .plan-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
  }

  /* ── Popular card (middle) ── */
  .plan-card.popular {
    border: 2px dashed #7125BE;
  }
  .popular-ribbon {
    background: linear-gradient(135deg, #7125BE, #9b59b6);
    color: #fff;
    text-align: center;
    padding: 6px 0;
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    border-radius: 14px 14px 0 0;
    margin: -1px -1px 0 -1px; /* bleed into the dashed border */
  }

  /* ── Card header ── */
  .plan-header {
    padding: 1.8rem 1.2rem 0.8rem;
    text-align: center;
  }
  .plan-name {
    font-size: 1.15rem;
    font-weight: 700;
    color: #222;
    margin-bottom: 0.9rem;
  }

  /* ── Price area ── */
  .plan-price-row {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 6px;
    margin-bottom: 4px;
  }
  .price-strike {
    text-decoration: line-through;
    color: #bbb;
    font-size: 0.95rem;
  }
  .price-main {
    font-size: 2.4rem;
    font-weight: 800;
    color: #7125BE;
    line-height: 1;
  }
  .price-period {
    font-size: 0.9rem;
    color: #888;
  }
  .plan-inr {
    font-size: 0.82rem;
    color: #999;
    margin-bottom: 1rem;
  }
  .plan-inr .inr-strike {
    text-decoration: line-through;
    margin-right: 3px;
  }

  /* ── Current badge ── */
  .current-badge {
    display: inline-block;
    background: #d1fae5;
    color: #059669;
    padding: 2px 10px;
    border-radius: 20px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
  }

  /* ── Feature list ── */
  .plan-features {
    padding: 0 1.2rem;
    flex: 1;
  }
  .plan-features ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .plan-features li {
    padding: 7px 0;
    font-size: 0.88rem;
    color: #444;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid #f5f5f5;
  }
  .plan-features li:last-child { border-bottom: none; }

  .fi {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
  }
  .fi.y { background: #d1fae5; color: #059669; }
  .fi.n { background: #fee2e2; color: #dc2626; }
  .fi.e { background: #ede9fe; color: #7125BE; }

  .feat-dim { color: #bbb; }

  /* ── CTA button ── */
  .plan-cta { padding: 1rem 1.2rem 1.4rem; }
  .plan-cta .btn {
    width: 100%;
    padding: 11px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.92rem;
    border: none;
    transition: all 0.2s ease;
  }
  .btn-plan {
    background: linear-gradient(135deg, #7125BE, #5b1d9e);
    color: #fff;
  }
  .btn-plan:hover {
    background: linear-gradient(135deg, #5b1d9e, #4a1582);
    color: #fff;
    box-shadow: 0 4px 14px rgba(113, 37, 190, 0.3);
  }
  .btn-ent {
    background: #7125BE;
    color: #fff;
  }
  .btn-ent:hover { background: #5b1d9e; color: #fff; }

  /* ── Custom / On-Premise extras ── */
  .custom-price-text {
    font-size: 2rem;
    font-weight: 800;
    color: #7125BE;
    line-height: 1;
    margin-bottom: 4px;
  }
  .custom-sub { font-size: 0.85rem; color: #888; margin-bottom: 0.8rem; }
  .custom-quote {
    font-style: italic;
    color: #888;
    font-size: 0.82rem;
    padding: 0 0.2rem;
    margin-bottom: 0.8rem;
    line-height: 1.5;
  }
</style>

<section class="pricing-section">
  <div class="container">
    <div class="pricing-header">
      <h2>Choose Your Plan</h2>
      <p>Simple, transparent pricing. Start with a free trial, upgrade as you grow.</p>
    </div>

    <div class="plans-grid">
      {% for plan in qs_plans %}
      <div class="plan-card {% if forloop.counter == 2 %}popular{% endif %}">

        {% if forloop.counter == 2 %}
        <div class="popular-ribbon">Most Popular</div>
        {% endif %}

        <div class="plan-header">
          {% if active_allot and active_allot.plan_id == plan.plan_id %}
          <span class="current-badge">Current Plan</span>
          {% endif %}

          <div class="plan-name">{{ plan.plan_name }}</div>

          <div class="plan-price-row">
            {% if plan.is_trial and plan.parent_plan %}
            <span class="price-strike">${{ plan.parent_plan.amount_usd|floatformat:0 }}</span>
            {% endif %}
            <span class="price-main">${{ plan.amount_usd|floatformat:0 }}</span>
            <span class="price-period">/month</span>
          </div>
          <div class="plan-inr">
            or
            {% if plan.is_trial and plan.parent_plan %}
            <span class="inr-strike">&#8377;{{ plan.parent_plan.amount|floatformat:0 }}</span>
            {% endif %}
            <span class="fw-bold">&#8377;{{ plan.amount|floatformat:0 }}</span>/mo
          </div>
        </div>

        <div class="plan-features">
          <ul>
            <li><span class="fi y">&#10003;</span> {{ plan.no_of_query }} Messages/month</li>
            <li><span class="fi y">&#10003;</span> {{ plan.no_of_bot }} Chatbot{{ plan.no_of_bot|pluralize }}</li>
            <li><span class="fi y">&#10003;</span> Train on {{ plan.no_of_file }} files per chatbot</li>
            <li><span class="fi y">&#10003;</span> Max {{ plan.max_file_size }}MB/file size</li>
            {% if forloop.counter >= 2 %}
            <li><span class="fi y">&#10003;</span> Gemini 1.5 Pro (Smart)</li>
            {% endif %}
            <li><span class="fi y">&#10003;</span> Zero-Training Guarantee</li>
            {% if forloop.counter >= 2 %}
            <li><span class="fi y">&#10003;</span> Remove Branding</li>
            {% else %}
            <li><span class="fi n">&#10007;</span> <span class="feat-dim">Remove Branding</span></li>
            {% endif %}
          </ul>
        </div>

        <div class="plan-cta">
          <form method="post" action="{% url 'qs_payment_checkout' %}">
            {% csrf_token %}
            <input type="hidden" name="plan_id" value="{{ plan.plan_id }}">
            {% if active_allot and active_allot.plan_id == plan.plan_id %}
            <button type="button" class="btn btn-outline-secondary" disabled>Current Plan</button>
            {% elif plan.is_trial %}
            <button type="submit" class="btn btn-plan">Start {{ plan.days }}-Day FREE Trial</button>
            {% else %}
            <button type="submit" class="btn btn-plan">Select Plan</button>
            {% endif %}
          </form>
        </div>
      </div>
      {% empty %}
      <!-- fallback when no plans exist -->
      <div style="grid-column:1/-1; text-align:center;">
        <p class="text-muted">No plans are available at the moment.</p>
      </div>
      {% endfor %}

      <!-- On-Premise / Custom -->
      <div class="plan-card">
        <div class="plan-header">
          <div class="plan-name">On-Premise</div>
          <div class="custom-price-text">Custom</div>
          <div class="custom-sub">Tailored to your infrastructure</div>
          <div class="custom-quote">"No two businesses are the same, so no two implementations should be either."</div>
        </div>
        <div class="plan-features">
          <ul>
            <li><span class="fi e">&#9641;</span> Custom setup on Own Server</li>
            <li><span class="fi e">&#9641;</span> User Level Tokenization (SSO)</li>
            <li><span class="fi e">&#9641;</span> 100% Privacy Guarantee</li>
            <li><span class="fi e">&#9641;</span> Full Implementation Customization</li>
            <li><span class="fi e">&#9641;</span> Dedicated Success Manager</li>
          </ul>
        </div>
        <div class="plan-cta">
          <a href="{% url 'help_support' %}" class="btn btn-ent">Contact Sales</a>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
